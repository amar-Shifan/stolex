<%-include('../partials/header.ejs')%>

<style>
	/* Wishlist container styling */
.wishlist-container {
  display: inline-flex;
  justify-content: center;
  align-items: center;
  width: 36px;
  height: 36px;
  border: 2px solid black;
  cursor: pointer;
  transition: all 0.3s ease;
}

/* Default heart style (white heart inside black border) */
.wishlist-heart {
  font-size: 20px;
  color: black; 
  transition: color 0.3s ease;
}

/* Background remains white by default */
.wishlist-container {
  background-color: white;
}

/* When clicked (add active class), heart turns red */
.wishlist-container.active {
  border-color: red;
  background-color: red;
}

.wishlist-container.active .wishlist-heart {
  color: white; /* Heart remains white when active */
}

/* Hover effect (optional) */
.wishlist-container:hover {
  transform: scale(1.1);
}


.star {
    margin-right: 5px;
    color: #dcdcdc; /* Light gray color for empty stars */
}

.star.filled {
    color: #f0b400; /* Yellow color for filled stars */
}

.rating-text {
    margin-left: 10px;
    font-size: 14px;
    color: #555; /* Text color for the rating description */
}

	.size-option {
    color: #000000; /* Default color */
    background-color: #ffffff; 
    padding: 5px 10px;
    border: 1px solid #ddd;
    cursor: pointer;
    text-decoration: none;
}

.size-option.selected {
    color: #fff; /* Dark text color */
    background-color: #000; /* Dark background */
    border: 1px solid #000;
}
.zoom-container {
    overflow: hidden;
    position: relative;
}

.zoom-image {
    transition: transform 0.2s ease;
    cursor: zoom-in;
}

.zoom-container:hover .zoom-image {
    cursor: zoom-out;
}
</style>
		<div class="breadcrumbs">
			<div class="container">
				<div class="row">
					<div class="col">
						<p class="bread"><span><a href="index.html">Home</a></span> / <span>Product Details</span></p>
					</div>
				</div>
			</div>
		</div>

		
		<div class="colorlib-product">
			<div class="container">
				<div class="row row-pb-lg product-detail-wrap">
					<div class="col-sm-6">
						<div class="owl-carousel">
						  <% product.images.forEach(image => { %>
							<div class="item">
							  <div class="product-entry border">
								<a href="#" class="prod-img">
									<div class="zoom-container">
										<img src="<%= image %>" class="img-fluid zoom-image" alt="Product Image" style="z-index: 3;">
									</div>
								</a>
							  </div>
							</div>
						  <% }); %>
						</div>
					</div>
					 
					 
					<div class="col-sm-4">
						<div class="product-desc">
							<h3><%= product.name %></h3>
							<p class="price">
								<span>$<%= product.price.toFixed(2) %></span>
							</p>
							<p><%= product.description %></p>
							<p>Brand : <%= product.brand %></p>

							<div class="product-rating">
								<span class="star filled">★</span>
								<span class="star filled">★</span>
								<span class="star filled">★</span>
								<span class="star filled">★</span>
								<span class="star">★</span>
								<span class="rating-text">(4.0 out of 5 stars)</span>
							</div>
							<div class="size-wrap">
								<div class="block-26 mb-2">
									<h4>Size</h4>
									<ul id="size-list">
										<% product.stock.forEach((stock) => { %>
											<li>
												<button 
													class="size-option btn btn-outline-dark" 
													data-size="<%= stock.size %>" 
													data-quantity="<%= stock.quantity %>">
													<%= stock.size %>
												</button>
											</li>
										<% }) %>
									</ul>
								</div>
							</div>
							

							
							<div class="stock-info">
								<h5>Total Stock: <span id="total-stock"><%= product.stock.reduce((total, stock) => total + stock.quantity, 0) %></span></h5>
								<h5>Available Stock for Selected Size: <span id="selected-stock">Select a size</span></h5>
							</div>
							
							<div class="input-group mb-4">
								<span class="input-group-btn">
									<button type="button" class="quantity-left-minus btn" data-type="minus">
										<i class="icon-minus2"></i>
									</button>
								</span>
								<input type="text" id="quantity" name="quantity" class="form-control input-number" value="1" min="1" max="<%= product.stock.reduce((total, stock) => total + stock.quantity, 0) %>">

								<span class="input-group-btn ml-1">
									<button type="button" class="quantity-right-plus btn" data-type="plus">
										<i class="icon-plus2"></i>
									</button>
								</span>
							</div>
							  
							<div class="row">
								<div class="col-sm-12 text-center">
								  <div class="d-flex justify-content-center align-items-center">
									<!-- Add to Cart Button -->
									<a href="/cart/add/<%= product._id %>" class="btn btn-dark btn-addtocart mr-3">
									  <i class="icon-shopping-cart"></i> Add to Cart
									</a>
							  
									<!-- Add to Wishlist Button -->
									<div class="wishlist-container">
									  <i class="icon-heart wishlist-heart"></i>
									</div>
								  </div>
								</div>
							</div>
							  
						</div>
					</div>
				</div>
		
				<div class="row">
					<div class="col-sm-12">
						<div class="row">
							<div class="col-md-12 pills">
								<div class="bd-example bd-example-tabs">
									<ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
										<li class="nav-item">
											<a class="nav-link active" id="pills-description-tab" data-toggle="pill" href="#pills-description" role="tab" aria-controls="pills-description" aria-expanded="true">Description</a>
										</li>
										<li class="nav-item">
											<a class="nav-link" id="pills-manufacturer-tab" data-toggle="pill" href="#pills-manufacturer" role="tab" aria-controls="pills-manufacturer" aria-expanded="true">Brand</a>
										</li>
										<li class="nav-item">
											<a class="nav-link" id="pills-review-tab" data-toggle="pill" href="#pills-review" role="tab" aria-controls="pills-review" aria-expanded="true">Review</a>
										</li>
									</ul>
		
									<div class="tab-content" id="pills-tabContent">
										<div class="tab-pane border fade show active" id="pills-description" role="tabpanel" aria-labelledby="pills-description-tab">
											<p><%= product.description %></p>
										</div>
		
										<div class="tab-pane border fade" id="pills-manufacturer" role="tabpanel" aria-labelledby="pills-manufacturer-tab">
											<p>Brand: <%= product.brand || 'N/A' %></p>
										</div>
										<div class="tab-pane border fade" id="pills-review" role="tabpanel" aria-labelledby="pills-review-tab">
											<div class="row">
												 <div class="col-md-8">
													 <h3 class="head">23 Reviews</h3>
													 <div class="review">
														 <div class="user-img" style="background-image: url(images/person1.jpg)"></div>
														 <div class="desc">
															 <h4>
																 <span class="text-left">Jacob Webb</span>
																 <span class="text-right">14 March 2018</span>
															 </h4>
															 <p class="star">
																 <span>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-half"></i>
																	 <i class="icon-star-empty"></i>
																 </span>
																 <span class="text-right"><a href="#" class="reply"><i class="icon-reply"></i></a></span>
															 </p>
															 <p>When she reached the first hills of the Italic Mountains, she had a last view back on the skyline of her hometown Bookmarksgrov</p>
														 </div>
													 </div>
													 <div class="review">
														 <div class="user-img" style="background-image: url(images/person2.jpg)"></div>
														 <div class="desc">
															 <h4>
																 <span class="text-left">Jacob Webb</span>
																 <span class="text-right">14 March 2018</span>
															 </h4>
															 <p class="star">
																 <span>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-half"></i>
																	 <i class="icon-star-empty"></i>
																 </span>
																 <span class="text-right"><a href="#" class="reply"><i class="icon-reply"></i></a></span>
															 </p>
															 <p>When she reached the first hills of the Italic Mountains, she had a last view back on the skyline of her hometown Bookmarksgrov</p>
														 </div>
													 </div>
													 <div class="review">
														 <div class="user-img" style="background-image: url(images/person3.jpg)"></div>
														 <div class="desc">
															 <h4>
																 <span class="text-left">Jacob Webb</span>
																 <span class="text-right">14 March 2018</span>
															 </h4>
															 <p class="star">
																 <span>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-half"></i>
																	 <i class="icon-star-empty"></i>
																 </span>
																 <span class="text-right"><a href="#" class="reply"><i class="icon-reply"></i></a></span>
															 </p>
															 <p>When she reached the first hills of the Italic Mountains, she had a last view back on the skyline of her hometown Bookmarksgrov</p>
														 </div>
													 </div>
												 </div>
												 <div class="col-md-4">
													 <div class="rating-wrap">
														 <h3 class="head">Give a Review</h3>
														 <div class="wrap">
															 <p class="star">
																 <span>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-full"></i>
																	 (98%)
																 </span>
																 <span>20 Reviews</span>
															 </p>
															 <p class="star">
																 <span>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-empty"></i>
																	 (85%)
																 </span>
																 <span>10 Reviews</span>
															 </p>
															 <p class="star">
																 <span>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-empty"></i>
																	 <i class="icon-star-empty"></i>
																	 (70%)
																 </span>
																 <span>5 Reviews</span>
															 </p>
															 <p class="star">
																 <span>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-empty"></i>
																	 <i class="icon-star-empty"></i>
																	 <i class="icon-star-empty"></i>
																	 (10%)
																 </span>
																 <span>0 Reviews</span>
															 </p>
															 <p class="star">
																 <span>
																	 <i class="icon-star-full"></i>
																	 <i class="icon-star-empty"></i>
																	 <i class="icon-star-empty"></i>
																	 <i class="icon-star-empty"></i>
																	 <i class="icon-star-empty"></i>
																	 (0%)
																 </span>
																 <span>0 Reviews</span>
															 </p>
														 </div>
													 </div>
												 </div>
											 </div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="related-products mt-5">
				<h2 class="text-center mb-4">Related Products</h2>
				<div class="row">
				  <% if (relatedProducts && relatedProducts.length > 0) { %>
					<% relatedProducts.forEach(relatedProduct => { %>
					  <div class="col-md-3 mb-4">
						<div class="card border-0 shadow-sm">
						  <!-- Product Image -->
						  <img
							src="<%= relatedProduct.images && relatedProduct.images.length > 0 ? relatedProduct.images[0] : '/default-image.jpg' %>"
							class="card-img-top"
							alt="<%= relatedProduct.name %>"
							style="height: 200px; object-fit: cover;"
						  />
						  <div class="card-body text-center">
							<h5 class="card-title text-truncate" title="<%= relatedProduct.name %>">
							  <%= relatedProduct.name %>
							</h5>
							<p class="card-text">$<%= relatedProduct.price.toFixed(2) %></p>
							<a href="/product/<%= relatedProduct._id %>" class="btn btn-outline-dark btn-sm">
							  View Details
							</a>
						  </div>
						</div>
					  </div>
					<% }); %>
				  <% } else { %>
					<p class="text-center">No related products available.</p>
				  <% } %>
				</div>
			  </div>
			  
		</div>
		
		  
		
<script src="/js/confirmation.js"></script>
	<script>
		
		// sizes and stocks 
document.addEventListener('DOMContentLoaded', () => {
    const sizeOptions = document.querySelectorAll('.size-option');
    const totalStockElement = document.getElementById('total-stock');
    const selectedStockElement = document.getElementById('selected-stock');
    const quantityInput = document.getElementById('quantity');
    const minusButton = document.querySelector('.quantity-left-minus');
    const plusButton = document.querySelector('.quantity-right-plus');

    // Default stock to show total stock
    let totalStock = parseInt(totalStockElement.textContent, 10);
    let selectedStock = null; // To track the selected stock
    let selectedSize = null;  // To track the selected size

    // Add event listeners to size options
    sizeOptions.forEach(option => {
        option.addEventListener('click', (event) => {
            event.preventDefault(); // Prevent default link behavior

            // Highlight the selected size
            sizeOptions.forEach(opt => opt.classList.remove('selected'));
            option.classList.add('selected');

            // Update stock display for the selected size
            selectedStock = parseInt(option.dataset.quantity, 10); // Get stock from data attribute
            selectedSize = option.dataset.size; // Track the selected size
            selectedStockElement.textContent = selectedStock;
            quantityInput.value = 1; // Reset quantity to 1
            quantityInput.max = selectedStock; // Update max value for the input field
        });
    });

    // Increment and decrement quantity
    if (minusButton && plusButton && quantityInput) {
        // Decrement the quantity when the minus button is clicked
        minusButton.addEventListener('click', function (event) {
            event.preventDefault(); // Prevent any default behavior
            let currentValue = parseInt(quantityInput.value);
            if (currentValue > 1) {
                quantityInput.value = currentValue - 1;
            }
        });

        // Increment the quantity when the plus button is clicked
        plusButton.addEventListener('click', function (event) {
            event.preventDefault(); // Prevent any default behavior
            let currentValue = parseInt(quantityInput.value);
            let maxValue = parseInt(quantityInput.getAttribute('max'));

            if (selectedStock === null) {
                // alert("Please select a size first!");
				confirmationUtil.confirm({
					message: 'Please select a size first!',
					confirmText: 'Ok',
					cancelText: 'Cancel',
				})
                return;
            }

            if (currentValue < maxValue) {
                quantityInput.value = currentValue + 1;
            }
        });


		// add to wishlist 
		const wishlistContainer = document.querySelector('.wishlist-container');

		wishlistContainer.addEventListener('click', () => {
			// Toggle the "active" class to change the color
			wishlistContainer.classList.toggle('active');
		});


    }

    // Reset selection when clicking outside the size options (optional)
    document.body.addEventListener('click', (event) => {
        if (!event.target.closest('.size-wrap') && !event.target.closest('.input-group')) {
            sizeOptions.forEach(opt => opt.classList.remove('selected'));
            selectedStock = null; // Reset selected stock
            selectedSize = null; // Reset selected size
            selectedStockElement.textContent = 'Select a size';
            quantityInput.value = 1;
            quantityInput.max = totalStock; // Reset max to total stock
        }
    });
});




// zooming image 
const zoomImages = document.querySelectorAll('.zoom-image');

zoomImages.forEach((image) => {
    image.addEventListener('mousemove', (e) => {
        const imageRect = image.getBoundingClientRect();
        const x = e.clientX - imageRect.left;
        const y = e.clientY - imageRect.top;
        
        const xPercent = (x / imageRect.width) * 100;
        const yPercent = (y / imageRect.height) * 100;
        
        image.style.transformOrigin = `${xPercent}% ${yPercent}%`;
        image.style.transform = 'scale(1.5)';
    });
    
    image.addEventListener('mouseleave', () => {
        image.style.transform = 'scale(1)';
    });
});



		$(document).ready(function(){

	var quantitiy=0;
   $('.quantity-right-plus').click(function(e){
		
		// Stop acting like a button
		e.preventDefault();
		// Get the field name
		var quantity = parseInt($('#quantity').val());
		
		// If is not undefined
			
			$('#quantity').val(quantity + 1);

		  
			// Increment
		
	});

	 $('.quantity-left-minus').click(function(e){
		// Stop acting like a button
		e.preventDefault();
		// Get the field name
		var quantity = parseInt($('#quantity').val());
		
		// If is not undefined
	  
			// Increment
			if(quantity>0){
			$('#quantity').val(quantity - 1);
			}
	});
	
	});

</script>
<%-include('../partials/footer.ejs') %>


